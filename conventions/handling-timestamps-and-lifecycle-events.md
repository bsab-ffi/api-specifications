# Handling Timestamps and Lifecycle Events

By defining this section within the General FFI API Conventions, we ensure consistency in how all parties manage, interpret, and audit the lifecycle of messages exchanged across the FFI network. This promotes traceability, supports compliance with SLA boundaries, and enables interoperable behavior across clients and servers.

## General Principles

- This convention defines the standard message lifecycle for all message exchanges via the FFI Core API.
- It applies to **requests**, **responses**, and optionally **errors**.
- All lifecycle transitions must be observable through defined timestamp fields.
- API consumers and providers **MUST** align to the behavioral expectations for lifecycle-related operations such as **ACKNOWLEDGE** and **DELETE**.

## Lifecycle Phases

Each message exchange in FFI follows these possible phases:

| Phase                             | Description                                                                 |
|----------------------------------|-----------------------------------------------------------------------------|
| **Request Created**              | The request is constructed on the client side. Not part of the FFI API.    |
| **Request Accepted**             | The request is received and registered by the server (`X-FFI-CreateDateTime` on the request). |
| **Response Created**             | The response is generated by the server (`X-FFI-CreateDateTime` on the response). |
| **Response Made Available**      | The response is retrievable via `GET /responses`.                          |
| **Response Retrieved**           | The response is fetched via `GET /responses/{responseId}`.                 |
| **Response Acknowledged**        | The response is confirmed by client via `POST /responses/{responseId}/acknowledge`. |
| **Request Aborted/Deleted (Optional)**   | The request is aborted/deleted via `DELETE`, if allowed for the messageType.       |

## Standardized Timestamp Fields

The following timestamp field is used across the API and is **mandatory**:

| Field                   | Description                                                                 | Source  |
|------------------------|-----------------------------------------------------------------------------|---------|
| `X-FFI-CreateDateTime` | The timestamp when a request or response was created on the server side.    | Server  |

All timestamps **MUST** conform to the format specified by the `MessageTimestamp` schema (RFC 3339, UTC time).

## Lifecycle Operations

### Acknowledge

- Clients **SHOULD** acknowledge responses using `POST /responses/{responseId}/acknowledge`.
- The header `X-FFI-AcknowledgeStatus` **MUST** be set to either `SUCCEEDED` or `FAILED`.
- Servers MAY log the time of acknowledgement internally for traceability and SLA purposes.
- Once a response has been acknowledged, the server **MUST** remove it from availability for that client.

### Abort/Delete

- `DELETE` is available only for **requests**, using the `DELETE /requests/{requestId}` endpoint.
- The server MUST respond with `405 Method Not Allowed` if the message type does not allow deletion.
- Semantics (abort, cancel, hide) MUST be defined per messageType in schema or federation-specific documentation.
- Unless explicitly stated otherwise, deletion MUST be treated as a **soft delete** â€” i.e., the message remains audit-accessible.

## SLA and Audit Considerations

- SLA evaluation MUST be based on defined timestamp fields:
  - SLA **starts** at the `X-FFI-CreateDateTime` of the **request**.
  - SLA **ends** at the `X-FFI-CreateDateTime` of the **response**.
- A message exchange is considered **complete** when:
  - The response is acknowledged, or
  - The request is deleted, or
  - Auto-completion is applied when exceeding **[CompletionGracePeriod](#federation-specific-parameters)**.

## Consistency Across Message Exchange

- The same `messageType` and `messageTypeSchemaVersion` MUST be used consistently across:
  - The request
  - The corresponding response
  - Any error payloads linked to the message exchange
- Identifiers (`requestId`, `responseId`) MUST be used to correlate data across endpoints.
- Implementers MUST NOT change `messageType` or `schemaVersion` during the course of a message exchange.

## Federation-Specific Parameters

Certain parameters in this document are defined at the **federation level** and must be specified in the **FFI Federation Configuration Document**. These parameters include:

- **CompletionGracePeriod**: Defines the maximum allowed time from response creation to automatic lifecycle completion in cases where no explicit acknowledgement or deletion has occurred.
